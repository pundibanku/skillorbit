<!DOCTYPE html>
<html lang="hi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard - SkillOrbit</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>

<body class="protected-content">
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">ðŸš€</div>
                    <span>SkillOrbit</span>
                </a>
            </div>

            <ul class="sidebar-menu">
                <li>
                    <a href="user-dashboard.html" class="active">
                        <i class="fas fa-home menu-icon"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="#my-courses">
                        <i class="fas fa-book menu-icon"></i>
                        My Courses
                    </a>
                </li>
                <li>
                    <a href="courses.html">
                        <i class="fas fa-compass menu-icon"></i>
                        Explore Courses
                    </a>
                </li>
                <li>
                    <a href="#certificates">
                        <i class="fas fa-certificate menu-icon"></i>
                        Certificates
                    </a>
                </li>
                <li>
                    <a href="#settings">
                        <i class="fas fa-cog menu-icon"></i>
                        Settings
                    </a>
                </li>
                <li>
                    <a href="#" id="logoutBtn" style="color: var(--error);">
                        <i class="fas fa-sign-out-alt menu-icon"></i>
                        Logout
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Header -->
            <div class="dashboard-header">
                <div>
                    <button class="mobile-menu-btn" id="sidebarToggle" style="display: none;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Welcome back, <span id="userName">Student</span>! ðŸ‘‹</h1>
                </div>
                <div class="user-menu">
                    <button
                        style="background: none; border: none; color: var(--text-secondary); font-size: 1.25rem; cursor: pointer;">
                        <i class="fas fa-bell"></i>
                    </button>
                    <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Profile" class="user-avatar"
                        id="userAvatar">
                </div>
            </div>

            <!-- Stats -->
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="enrolledCount">3</h3>
                        <p>Enrolled Courses</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(0, 210, 106, 0.1); color: var(--success);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="completedCount">1</h3>
                        <p>Completed</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(255, 179, 71, 0.1); color: var(--warning);">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="hoursCount">24</h3>
                        <p>Hours Watched</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(255, 107, 107, 0.1); color: var(--accent);">
                        <i class="fas fa-certificate"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="certificatesCount">1</h3>
                        <p>Certificates</p>
                    </div>
                </div>
            </div>

            <!-- Continue Learning -->
            <section style="margin-bottom: 40px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="margin: 0;">Continue Learning</h2>
                    <a href="#my-courses" style="font-size: 0.875rem;">View All â†’</a>
                </div>

                <div class="my-courses-grid" id="myCourses">
                    <!-- Courses will be loaded here -->
                </div>
            </section>

            <!-- Recommended Courses -->
            <section>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="margin: 0;">Recommended for You</h2>
                    <a href="courses.html" style="font-size: 0.875rem;">Browse All â†’</a>
                </div>

                <div class="courses-grid" id="recommendedCourses"
                    style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));">
                    <!-- Recommended courses will be loaded here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script src="js/firebase-config.js"></script>
    <script src="js/security.js"></script>
    <script>
        // Sample enrolled courses
        const myCourses = [
            { id: 1, title: "Complete Web Development Bootcamp", image: "https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=400&h=200&fit=crop", progress: 45 },
            { id: 3, title: "Python Programming for Beginners", image: "https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=400&h=200&fit=crop", progress: 78 },
            { id: 5, title: "Data Science with Python", image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=200&fit=crop", progress: 12 }
        ];

        const recommendedCourses = [
            { id: 7, title: "Advanced JavaScript Mastery", category: "Programming", image: "https://images.unsplash.com/photo-1579468118864-1b9ea3c0db4a?w=400&h=250&fit=crop", price: 1999, rating: 4.8 },
            { id: 9, title: "Machine Learning A-Z", category: "Data Science", image: "https://images.unsplash.com/photo-1555949963-aa79dcee981c?w=400&h=250&fit=crop", price: 3999, rating: 4.9 },
            { id: 11, title: "Node.js Backend Development", category: "Web Development", image: "https://images.unsplash.com/photo-1627398242454-45a1465c2479?w=400&h=250&fit=crop", price: 2299, rating: 4.6 }
        ];

        // DOM Elements
        const myCoursesGrid = document.getElementById('myCourses');
        const recommendedGrid = document.getElementById('recommendedCourses');
        const toastContainer = document.getElementById('toastContainer');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // Render my courses
        function renderMyCourses() {
            myCoursesGrid.innerHTML = myCourses.map(course => `
                <div class="my-course-card" onclick="watchCourse(${course.id})">
                    <div class="my-course-image">
                        <img src="${course.image}" alt="${course.title}">
                    </div>
                    <div class="my-course-content">
                        <h3>${course.title}</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${course.progress}%"></div>
                        </div>
                        <p class="progress-text">${course.progress}% complete</p>
                    </div>
                </div>
            `).join('');
        }

        // Render recommended courses
        function renderRecommended() {
            recommendedGrid.innerHTML = recommendedCourses.map(course => `
                <div class="course-card" onclick="viewCourse(${course.id})" style="cursor: pointer;">
                    <div class="course-image">
                        <img src="${course.image}" alt="${course.title}">
                    </div>
                    <div class="course-content">
                        <span class="course-category">${course.category}</span>
                        <h3>${course.title}</h3>
                        <div class="course-footer">
                            <div class="course-price">â‚¹${course.price.toLocaleString()}</div>
                            <div class="course-rating">
                                <i class="fas fa-star"></i>
                                ${course.rating}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Navigation functions
        function watchCourse(courseId) {
            window.location.href = `watch-course.html?id=${courseId}`;
        }

        function viewCourse(courseId) {
            window.location.href = `course-detail.html?id=${courseId}`;
        }

        // Show toast
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            toastContainer.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                await FirebaseAuth.signOut();
                showToast('Logged out successfully!');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            } catch (error) {
                showToast('Logout failed', 'error');
            }
        });

        // Sidebar toggle for mobile
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');

        if (window.innerWidth <= 992) {
            sidebarToggle.style.display = 'block';
        }

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        // Check auth state
        FirebaseAuth.initAuthObserver((user) => {
            if (user) {
                document.getElementById('userName').textContent = user.displayName || 'Student';
                if (user.photoURL) {
                    document.getElementById('userAvatar').src = user.photoURL;
                }

                // Add watermark for security
                if (window.SecurityModule) {
                    SecurityModule.addWatermark(user.email);
                }
            } else {
                // User not logged in, using demo mode
                console.log('Demo mode - no user logged in');
            }
        });

        // Initialize
        renderMyCourses();
        renderRecommended();
    </script>
</body>

</html>